mkdir -p /app
 
 
# Prepare the filesystem
mkdir -p /tmp/build
cd /tmp/build
 
 
# Compiling Apache
curl http://www.us.apache.org/dist/httpd/httpd-2.2.22.tar.gz | tar xzf -
 
cd httpd-2.2.22
./configure --prefix=/app/apache --with-z=/usr/local/zlib --enable-rewrite --enable-so --enable-deflate --enable-expires --enable-headers
make && make install
cd ..
 
 
# Apache libraries
mkdir -p /app/php/ext
cp /app/apache/lib/libapr-1.so /app/php/ext
cp /app/apache/lib/libaprutil-1.so /app/php/ext
cp /app/apache/lib/libapr-1.so.0 /app/php/ext
cp /app/apache/lib/libaprutil-1.so.0 /app/php/ext
 
 
# Compiling PHP
curl -L http://php.net/get/php-5.4.9.tar.gz/from/us1.php.net/mirror | tar xzf -
 
cd php-5.4.9
./configure --prefix=/app/php --with-apxs2=/app/apache/bin/apxs --with-pgsql --with-pdo-pgsql --with-iconv --with-config-file-path=/app/php --with-openssl --with-readline --enable-mbstring --with-gd --with-jpeg-dir=/usr --with-curl=/usr
make && make install
cd ..
 
 
# PHP Extensions
cp php-5.4.9/libs/libphp5.so /app/apache/modules/
 
 
# APC
curl http://pecl.php.net/get/APC/3.1.13 | tar xzf -
 
cd APC-3.1.13
/app/php/bin/phpize
./configure --enable-apc --enable-apc-mmap --with-php-config=/app/php/bin/php-config
make && make install
cd ..
 
# MongoDB
curl http://pecl.php.net/get/mongo/1.3.2 | tar xzf -
 
cd mongo-1.3.2
/app/php/bin/phpize
./configure --with-php-config=/app/php/bin/php-config
make && make install
cd ..
 
mv /app/php/lib/php/extensions/no-debug-non-zts-20100525/*.so /app/php/ext/
rm -rf /app/php/lib/php/extensions
 
 
# Create packages
cd /app
 
echo '2.2.22' > apache/VERSION
tar -zcvf apache.tar.gz apache
 
echo '5.4.9' > php/VERSION
tar -zcvf php.tar.gz php
 
 
# Upload to your server using SCP
# scp '-P 22' apache.tar.gz root@domain.tld:/path/to
# scp '-P 22' php.tar.gz root@domain.tld:/path/to
